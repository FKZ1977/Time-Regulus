<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Time Regulus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0e0f11;
      --card-bg: rgba(120, 110, 255, 0.38);
      --accent: #00ffe0;
      --text-main: #e0e0e0;
      --text-sub: #999;
      --btn-bg: #00ffe0;
      --btn-text: #000;
      --deep-green: #134d33;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    input:focus, select:focus, button:focus {
      outline: 2px solid var(--accent);
      box-shadow: 0 0 6px var(--accent);
    }

    h1.fkz {
      font-size: 48px;
      color: var(--accent);
      text-shadow: 0 0 12px var(--accent);
      margin-top: 60px;
      letter-spacing: 4px;
    }

    .subtitle {
      font-size: 16px;
      color: var(--text-sub);
      margin-bottom: 40px;
    }

    .mode-card {
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      margin-top: 40px;
    }

    .deep-green {
      background-color: var(--deep-green);
    }

    .input-group {
      margin-top: 12px;
      margin-bottom: 20px;
    }

    input[type="datetime-local"] {
      width: 220px;
    }

    .seconds-select {
      width: 80px;
      margin-top: 8px;
    }

    #errorDirection {
      width: 160px;
      display: inline-block;
      margin-left: 8px;
      color: red;
    }

    input, select {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #1f1f2f;
      color: var(--text-main);
    }

    .action-btn {
      background-color: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 4px 12px rgba(0,255,224,0.3);
      transition: transform 0.2s ease;
    }

    .action-btn:hover {
      transform: scale(1.05);
    }

    .back-btn {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 16px;
      margin-bottom: 20px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .back-btn:hover {
      transform: scale(1.05);
    }

    .result-box {
      margin-top: 30px;
      font-size: 18px;
      line-height: 1.6;
      color: var(--accent);
      text-align: center;
      margin: 20px 0;
    }

    .result-box p {
      margin: 20px 0;
    }

    .flex-wrap {
      display: flex;
      flex-direction: row;
      gap: 6px;
      flex-wrap: nowrap;
      overflow-x: auto;
      margin-bottom: 24px;
    }

    .unit-input {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 12px;
      flex: 1 1 auto;
      min-width: 60px;
    }

    .unit-input input {
      width: 30px;
      min-width: 30px;
      max-width: 30px;
      padding: 4px 6px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      background-color: #1f1f2f;
      color: var(--text-main);
      text-align: right;
    }

    .unit-label {
      font-size: 14px;
      color: var(--text-main);
      white-space: nowrap;
      margin-left: 2px;
    }

    #lockScreen {
      text-align: center;
      margin-top: 100px;
    }

    #lockScreen input {
      width: 100px;
      text-align: center;
      padding: 10px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      color: var(--text-main);
    }

    #modeSelect {
      padding-top: 80px;
    }

    #errorMode, #correctionMode {
      padding-top: 60px;
    }
  </style>
</head>

<body>
  <!-- ğŸ” ãƒ­ãƒƒã‚¯ç”»é¢ï¼šåˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ› -->
  <div id="lockScreen">
    <h1 class="fkz">Time Regulus</h1>
    <p class="subtitle" font-size: 15px;">ã‚¿ã‚¤ãƒ ã€€ãƒ¬ã‚°ãƒ«ã‚¹</p>
    <label for="passcode">æš—è¨¼ç•ªå·ã‚’å…¥åŠ›ï¼š</label><br>
    <input type="password" id="passcode" placeholder="ä¾‹ï¼š1234" tabindex="1">
    <button class="action-btn" onclick="checkPass()" tabindex="2">é–‹ã</button>
    <p id="error" style="color:red;"></p><br>
    <p class="subtitle">- produced by H.Fukazu -</p>
  </div>

  <!-- ğŸ” ãƒ¢ãƒ¼ãƒ‰é¸æŠç”»é¢ï¼šèª¤å·® or è£œæ­£ -->
  <div id="modeSelect" style="display:none; text-align:center;">
    <h1 class="fkz">Time Regulus</h1>
    <p class="subtitle">- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -</p>
    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; margin-top: 40px;">
      <button class="action-btn" onclick="showErrorMode()" tabindex="3">èª¤å·®ã®è¨ˆç®—</button>
      <button class="action-btn" onclick="showCorrectionMode()" tabindex="4">è£œæ­£æ™‚åˆ»ã®è¨ˆç®—</button>
    </div>
  </div>

  <!-- ğŸ§® èª¤å·®è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ï¼šæ¨™æº–æ™‚åˆ»ã¨è¡¨ç¤ºæ™‚åˆ»ã®å·®åˆ†ã‚’è¨ˆç®— -->
  <div id="errorMode" class="mode-card" style="display:none;">
    <button class="back-btn" onclick="backToModeSelect()" tabindex="5">â† ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
    <p class="subtitle">èª¤å·®æ™‚åˆ»ã®è¨ˆç®—</p>

    <!-- ğŸ•’ æ¨™æº–æ™‚åˆ»å…¥åŠ› -->
    <div class="input-group">
      <label for="standardTime">æ¨™æº–æ™‚åˆ»:</label><br>
      <input type="datetime-local" id="standardTime" step="60" tabindex="6">
      <select id="standardSeconds" class="seconds-select" tabindex="7">
        <option value="">ç§’</option>
      </select>
    </div>

    <!-- ğŸ•’ è¡¨ç¤ºæ™‚åˆ»å…¥åŠ› -->
    <div class="input-group">
      <label for="displayTime">è¡¨ç¤ºæ™‚åˆ»:</label><br>
      <input type="datetime-local" id="displayTime" step="60" tabindex="8">
      <select id="displaySeconds" class="seconds-select" tabindex="9">
        <option value="">ç§’</option>
      </select>
    </div>

    <!-- ğŸ§® è¨ˆç®—ãƒœã‚¿ãƒ³ -->
    <button class="action-btn" onclick="calculateError()" tabindex="10">èª¤å·®æ™‚é–“ã‚’è¨ˆç®—</button>

    <!-- ğŸ“Š çµæœè¡¨ç¤º -->
    <div id="result" class="result-box"></div>

    <!-- ğŸ” è£œæ­£ãƒ¢ãƒ¼ãƒ‰ã¸ã®åˆ‡ã‚Šæ›¿ãˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div id="correctionPreview">
      <div id="correctionResult"></div>
      <div id="toReverseButton" style="display: none; margin-top: 20px;">
        <button class="action-btn" onclick="switchToCorrectionMode()" tabindex="11">ã“ã®èª¤å·®ã§é€†ç®—ã™ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- ğŸ”§ è£œæ­£ãƒ¢ãƒ¼ãƒ‰ï¼šèª¤å·®ã‹ã‚‰æ¨™æº–æ™‚åˆ»ã‚’é€†ç®— -->
  <div id="correctionMode" class="mode-card deep-green" style="display:none;">
    <button class="back-btn" onclick="backToModeSelect()" tabindex="12">â† ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
    <p class="subtitle">è£œæ­£æ™‚åˆ»ã®è¨ˆç®—</p>

    <!-- â±ï¸ èª¤å·®å…¥åŠ›ï¼ˆâ–¡æ—¥â–¡æ™‚â–¡åˆ†â–¡ç§’å½¢å¼ï¼‰ -->
    <label>è£œæ­£ã«ä½¿ã†èª¤å·®ï¼š</label>
    <div class="flex-wrap">
      <div class="unit-input">
        <input type="number" id="errorDays" min="0" step="1" oninput="reverseCalculate()" tabindex="13">
        <span class="unit-label">æ—¥</span>
      </div>
      <div class="unit-input">
        <input type="number" id="errorHours" min="0" max="23" step="1" oninput="reverseCalculate()" tabindex="14">
        <span class="unit-label">æ™‚</span>
      </div>
      <div class="unit-input">
        <input type="number" id="errorMinutes" min="0" max="59" step="1" oninput="reverseCalculate()" tabindex="15">
        <span class="unit-label">åˆ†</span>
      </div>
      <div class="unit-input">
        <input type="number" id="errorSeconds" min="0" max="59" step="1" oninput="reverseCalculate()" tabindex="16">
        <span class="unit-label">ç§’</span>
      </div>
    </div>

    <!-- ğŸ”½ èª¤å·®æ–¹å‘ã‚»ãƒ¬ã‚¯ãƒˆï¼ˆé€²ã‚“ã§ã„ã‚‹ï¼é…ã‚Œã¦ã„ã‚‹ï¼‰ -->
    <div class="input-group">
      <label for="errorDirection" style="display:inline-block;">è¡¨ç¤ºæ™‚åˆ»ã¯æ¨™æº–æ™‚åˆ»ã‚ˆã‚Šï¼š</label>
      <select id="errorDirection" onchange="reverseCalculate()" tabindex="17">
        <option value="late">é€²ã‚“ã§ã„ã‚‹</option>
        <option value="early">é…ã‚Œã¦ã„ã‚‹</option>
      </select>
    </div>

    <!-- ğŸ•’ è¡¨ç¤ºæ™‚åˆ»å…¥åŠ› -->
    <div class="input-group">
      <label for="reverseDisplayTime">è¡¨ç¤ºæ™‚åˆ»:</label><br>
      <input type="datetime-local" id="reverseDisplayTime" step="60" tabindex="18">
      <select id="reverseDisplaySeconds" class="seconds-select" tabindex="19">
        <option value="">ç§’</option>
      </select>
    </div>

    <!-- ğŸ§® è£œæ­£è¨ˆç®—ãƒœã‚¿ãƒ³ -->
    <button class="action-btn" onclick="reverseCalculate()" tabindex="20">è£œæ­£æ™‚åˆ»ã‚’è¨ˆç®—</button>

    <!-- ğŸ“Š è£œæ­£çµæœè¡¨ç¤º -->
    <div id="reverseResult" class="result-box"></div>
  </div>

  <!-- ğŸ§  ãƒ­ã‚¸ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹ -->
  <script>
    let lastError = null;
    let hasCalculated = false; // âœ… åˆå›è¨ˆç®—æ¸ˆã¿ã‹ã©ã†ã‹åˆ¤å®šç”¨

    // ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼å‡¦ç†
    function checkPass() {
      const inputField = document.getElementById("passcode");
      const input = inputField.value;
      const correct = "164";
      const errorMessage = document.getElementById("error");

      if (input === correct) {
        document.getElementById("lockScreen").style.display = "none";
        document.getElementById("modeSelect").style.display = "block";
        inputField.blur();
        inputField.style.border = "";
        errorMessage.innerText = "";
      } else {
        errorMessage.innerText = "æš—è¨¼ç•ªå·ãŒé•ã„ã¾ã™";
        inputField.style.border = "2px solid red";
      }
    }

    // âŒ¨ï¸ èµ·å‹•æ™‚ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¬„ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼‹Enterã‚­ãƒ¼å¯¾å¿œï¼‹ç§’ã‚»ãƒ¬ã‚¯ãƒˆç”Ÿæˆï¼‹è‡ªå‹•å†è¨ˆç®—ã‚¤ãƒ™ãƒ³ãƒˆ
    document.addEventListener("DOMContentLoaded", function () {
      const passInput = document.getElementById("passcode");
      if (passInput) {
        passInput.focus();
        passInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            checkPass();
          }
        });
      }

      populateSeconds("standardSeconds");
      populateSeconds("displaySeconds");
      populateSeconds("reverseDisplaySeconds");

      document.getElementById("reverseDisplayTime").addEventListener("input", function () {
        if (hasCalculated) reverseCalculate();
      });
      document.getElementById("reverseDisplaySeconds").addEventListener("change", function () {
        if (hasCalculated) reverseCalculate();
      });
    });

    // â±ï¸ ç§’ã‚»ãƒ¬ã‚¯ãƒˆç”Ÿæˆï¼ˆ0ã€œ59ç§’ï¼‰
    function populateSeconds(selectId) {
      const select = document.getElementById(selectId);
      if (!select || select.options.length > 1) return;
      for (let i = 0; i <= 59; i++) {
        const option = document.createElement("option");
        option.value = i;
        option.text = `${String(i).padStart(2, '0')}ç§’`;
        select.appendChild(option);
      }
    }

    // ğŸ” ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
    function showErrorMode() {
      document.getElementById("modeSelect").style.display = "none";
      document.getElementById("errorMode").style.display = "block";
    }

    function showCorrectionMode() {
      document.getElementById("modeSelect").style.display = "none";
      document.getElementById("correctionMode").style.display = "block";
    }

    function backToModeSelect() {
      document.getElementById("errorMode").style.display = "none";
      document.getElementById("correctionMode").style.display = "none";
      document.getElementById("modeSelect").style.display = "block";
    }

    // ğŸ§® èª¤å·®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
    function calculateError() {
      const standardInput = document.getElementById("standardTime").value;
      const displayInput = document.getElementById("displayTime").value;
      const standardSec = Number(document.getElementById("standardSeconds").value || 0);
      const displaySec = Number(document.getElementById("displaySeconds").value || 0);

      if (!standardInput || !displayInput) {
        document.getElementById("result").innerText = "ä¸¡æ–¹ã®æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      const standard = new Date(standardInput);
      const display = new Date(displayInput);
      standard.setSeconds(standardSec);
      display.setSeconds(displaySec);

      const diffMs = Math.abs(standard - display);
      const isFast = display < standard;

      const totalSeconds = Math.floor(diffMs / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      const resultElement = document.getElementById("result");

      if (totalSeconds === 0) {
        resultElement.innerHTML = `
          <span style="color: var(--accent); font-weight: bold;">Perfect Sync!</span><br>
          <span style="color: var(--text-sub); font-size: 15px;">è¡¨ç¤ºæ™‚åˆ»ã¯æ¨™æº–æ™‚åˆ»ã¨å®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚</span>
        `;
        return;
      }

      const parts = [];
      if (days > 0) parts.push(`${days}æ—¥`);
      if (hours > 0) parts.push(`${hours}æ™‚é–“`);
      if (minutes > 0) parts.push(`${minutes}åˆ†`);
      if (seconds > 0) parts.push(`${seconds}ç§’`);

      const direction = isFast ? "é…ã‚Œã¦ã„ã¾ã™ã€‚" : "é€²ã‚“ã§ã„ã¾ã™ã€‚";

      resultElement.innerHTML = `
        <span style="color: var(--accent); font-weight: bold;">${parts.join("")}</span><br>
        <span style="color: var(--text-sub);">${direction}</span>
      `;

      lastError = { days, hours, minutes, seconds, isFast };
      document.getElementById("toReverseButton").style.display = "block";
    }

    // ğŸ” èª¤å·®ã‚’è£œæ­£ãƒ¢ãƒ¼ãƒ‰ã«åæ˜ 
    function applyLastErrorToReverseInputs() {
      if (!lastError) return;
      document.getElementById("errorDays").value    = lastError.days    || 0;
      document.getElementById("errorHours").value   = lastError.hours   || 0;
      document.getElementById("errorMinutes").value = lastError.minutes || 0;
      document.getElementById("errorSeconds").value = lastError.seconds || 0;
      document.getElementById("errorDirection").value = lastError.isFast ? "early" : "late";
      reverseCalculate();
    }

    // ğŸ” èª¤å·®è¨ˆç®—å¾Œã«è£œæ­£ãƒ¢ãƒ¼ãƒ‰ã¸åˆ‡ã‚Šæ›¿ãˆã‚‹
    function switchToCorrectionMode() {
      document.getElementById("errorMode").style.display = "none";
      document.getElementById("correctionMode").style.display = "block";
      populateSeconds("reverseDisplaySeconds");
      applyLastErrorToReverseInputs();
    }

    // ğŸ” è£œæ­£ãƒ­ã‚¸ãƒƒã‚¯ï¼šèª¤å·®ã¨è¡¨ç¤ºæ™‚åˆ»ã‹ã‚‰æ¨™æº–æ™‚åˆ»ã‚’é€†ç®—
    function reverseCalculate() {
      hasCalculated = true;
      const resultElement = document.getElementById("reverseResult");

      const days    = Number(document.getElementById("errorDays").value || 0);
      const hours   = Number(document.getElementById("errorHours").value || 0);
      const minutes = Number(document.getElementById("errorMinutes").value || 0);
      const seconds = Number(document.getElementById("errorSeconds").value || 0);
      const isLate  = document.getElementById("errorDirection").value === "late";

      const displayInput = document.getElementById("reverseDisplayTime").value;
      const displaySec   = Number(document.getElementById("reverseDisplaySeconds").value || 0);
      if (!displayInput) {
        resultElement.innerText = "è¡¨ç¤ºæ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      const displayTime = new Date(displayInput);
      displayTime.setSeconds(displaySec);

      const totalMs = ((days * 86400) + (hours * 3600) + (minutes * 60) + seconds) * 1000;
      const correctedTime = new Date(displayTime.getTime() + (isLate ? -totalMs : totalMs));

      const cy   = correctedTime.getFullYear();
      const cm   = String(correctedTime.getMonth() + 1).padStart(2, '0');
      const cd   = String(correctedTime.getDate()).padStart(2, '0');
      const ch   = String(correctedTime.getHours()).padStart(2, '0');
      const cmin = String(correctedTime.getMinutes()).padStart(2, '0');
      const cs   = String(correctedTime.getSeconds()).padStart(2, '0');

      resultElement.innerHTML = `
        <p style="color: var(--accent); font-weight: bold;">${cy}å¹´${cm}æœˆ${cd}æ—¥ ${ch}æ™‚${cmin}åˆ†${cs}ç§’</p>
        <p style="color: var(--text-sub);">ãŒè£œæ­£æ™‚åˆ»ã§ã™</p>
      `;
    }
  </script>
</body>
</html>